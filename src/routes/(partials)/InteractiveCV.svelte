<script lang="ts">
	import { useChat } from 'ai/svelte';
	import { gptQuestions } from '$lib/questions';

	const { messages, handleSubmit, input } = useChat({
		api: '/api/chat-bot/'
	});

	import { getModalStore } from '@skeletonlabs/skeleton';
	// Skeleton Types
	import type { ModalSettings } from '@skeletonlabs/skeleton';
	// Firebase related
	import { auth } from '$lib/firebaseClient';
	import { userStore } from 'sveltefire';

	const modalStore = getModalStore();

	const user = userStore(auth);

	let selectedValue = '';

	function handleSelect(e: Event) {
		$input = selectedValue;
		handleSubmit(e);
	}

	function showSignInModal() {
		const modal: ModalSettings = {
			type: 'component',
			component: 'signIn'
		};
		modalStore.trigger(modal);
	}
	function showSignUpModal() {
		const modal: ModalSettings = {
			type: 'component',
			component: 'signUp'
		};
		modalStore.trigger(modal);
	}
</script>

{#if $user?.uid}
	<section
		class="p-5 mx-auto container md:w-4/5 flex flex-col card relative variant-ghost-secondary gap-4 justify-center items-center"
	>
		<h2 class="text-2xl sm:text-3xl sm:leading-3xl font-bold text-surface-500 leading-2xl p-2">
			GPT Bot Interview.
		</h2>
		<p class="text-xl leading-xl bold md:w-3/4 text-center mx-auto">
			Ask GPT a question to learn about me. Choose from a list of questions to find more about me
			and my career journey.
		</p>
		<div class="variant-glass-secondary p-4 card text-surface-800 sm:w-4/5">
			<p>
				Note: This is a fun feature showcasing my third-party integration skills. While I've curated
				and guided prompts for better results, the final replies come from GPT and I have no control
				over them.. Enjoy!
			</p>
			<div class="flex justify-center pt-4">
				<input
					class="card mr-2 mt-1 variant-glass-secondary"
					type="checkbox"
					id="acknowledge"
					name="acknowledge"
				/>
				<label class="text-surface-800" for="acknowledge"
					>I acknowledge any information given in italics is generated by GPT and the accuracy of
					the information can't be guaranteed.
				</label>
			</div>
		</div>
		<label class="bold text-xl opacity-30" for="questions">Coming soon! </label>
		<select
			bind:value={selectedValue}
			on:change={(e) => handleSelect(e)}
			name="questions"
			id="questions"
			class="w-1/2 variant-glass-secondary card"
		>
			<option value="">--Feature coming soon....--</option>
			<option value={`${gptQuestions['art-dev'][1]}`}>{gptQuestions['art-dev'][0]} </option>
			<option value={`${gptQuestions['vue-certification'][1]}`}
				>{gptQuestions['vue-certification'][0]}
			</option>
			<!-- <option value={`${gptQuestions['vue-certification']}`}
				>{gptQuestions['vue-certification']}</option
			> -->
		</select>
		<div class="mx-auto variant-glass card w-full p-4 gap-4 flex flex-col">
			<h4 class="text-2xl leading-2xl font-bold">Answers: {$input}</h4>
			<div class="[&>*:nth-child(odd)]:font-bold [&>*:nth-child(even)]:pb-2">
				{#each $messages as message}
					<p>{message.content}</p>
				{/each}
			</div>
		</div>
	</section>
{/if}

{#if !$user?.uid}
	<section class="flex flex-col p-3 card w-3/4 mx-auto variant-soft-surface">
		<div class="variant-ghost-surface space-y-4 p-4">
			<h2 class="text-center text-2xl sm:text-3xl sm:leading-3xl font-bold leading-2xl">
				GPT Bot Interview.
			</h2>
			<h3 class="text-2xl leading-2xl text-center italic text-secondary-200">
				Sign in for access.
			</h3>
			<div class="mx-auto container flex flex-col items-center space-y-4">
				<button
					on:click={showSignInModal}
					class="btn variant-ghost-secondary ring-2 font-bold text-xl uppercase">Sign In</button
				>
				<button
					on:click={showSignUpModal}
					class="btn variant-ghost-primary ring-2 font-bold text-xl uppercase">Sign Up</button
				>
			</div>
		</div>
	</section>
{/if}
