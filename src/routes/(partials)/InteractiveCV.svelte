<script lang="ts">
	import { useChat } from 'ai/svelte';
	import { gptQuestions } from '$lib/questions';

	const { messages, handleSubmit, input } = useChat({ api: '/api/chat-bot/' });

	import { getModalStore } from '@skeletonlabs/skeleton';
	// Skeleton Types
	import type { ModalSettings } from '@skeletonlabs/skeleton';
	// Firebase related
	import { auth } from '$lib/firebaseClient';
	import { userStore } from 'sveltefire';

	const modalStore = getModalStore();

	const user = userStore(auth);

	function showSignInModal() {
		const modal: ModalSettings = {
			type: 'component',
			component: 'signIn'
		};
		modalStore.trigger(modal);
	}
	function showSignUpModal() {
		const modal: ModalSettings = {
			type: 'component',
			component: 'signUp'
		};
		modalStore.trigger(modal);
	}
</script>

<section
	class="p-4 container mx-auto flex flex-col card relative variant-ghost-secondary gap-4 justify-center items-center"
>
	{#if !$user?.uid}
		<h2 class="text-2xl sm:text-3xl sm:leading-3xl font-bold text-surface-500 leading-2xl p-2">
			GPT Bot Interview.
		</h2>

		<h3 class="text-2xl italic text-primary-500">Sign in for access.</h3>

		<button
			on:click={showSignInModal}
			class="btn variant-ghost-primary border-2 border-primary-500 text-primary-800 uppercase"
			>Sign In</button
		>

		<button
			on:click={showSignUpModal}
			class="btn variant-ghost-primary border-2 border-primary-500 text-primary-800 text-xl uppercase"
			>Sign Up</button
		>
	{:else}
		<p class="text-xl leading-3xl bold md:w-3/4 text-center mx-auto">
			Ask GPT a question to learn about me. Choose from a list of questions to find more about me
			and my career journey.
		</p>
		<div class="variant-glass-secondary p-4 card text-surface-800 sm:w-2/3">
			<p>
				Note: This is a fun feature showcasing my third-party integration skills. While I've curated
				and guided prompts for better results, the final replies come from GPT and I have no control
				over them.. Enjoy!
			</p>
			<div class="flex justify-center pt-4">
				<input
					class="card mr-2 mt-1 variant-glass-secondary"
					type="checkbox"
					id="acknowledge"
					name="acknowledge"
				/>
				<label class="text-surface-800" for="acknowledge"
					>I acknowledge any information given in italics is generated by GPT and the accuracy of
					the information can't be guaranteed.
				</label>
			</div>
		</div>
		<label class="bold text-xl opacity-30" for="questions">Coming soon! </label>
		<select
			bind:value={$input}
			on:change={handleSubmit}
			name="questions"
			id="questions"
			class="w-1/2 variant-glass-secondary card"
		>
			<option value="">--Feature coming soon....--</option>
			<option value="art-dev">{gptQuestions['art-dev']} </option>
			<option value="vue-certification">{gptQuestions['vue-certification']}</option>
		</select>
		<ul>
			{#each $messages as message, index}
				{#if index === 1}
					<li>{message.content}</li>
				{/if}
			{/each}
		</ul>
	</div>
</div>
	{/if}
</section>
